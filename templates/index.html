<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ryo Fujimura</title>
  <!-- Google Fonts for MuseoModerno -->
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno&display=swap" rel="stylesheet" />
  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
  <div class="container">
    <!-- Logo Tile -->
    <div id="logo" class="box" style="grid-area: logo;">
      {% if logo.image_filename %}
        <img
          src="{{ url_for('static', filename='images/' + logo.image_filename) }}"
          alt="Ryo Fujimura's Logo"
          loading="lazy"
        />
      {% endif %}
    </div>

    <!-- Profile Picture Tile -->
    <div id="profilePicture" class="box" style="grid-area: profilePicture;">
      {% if profile.image_filename %}
        <img
          id="profileImg"
          src="{{ url_for('static', filename='images/' + profile.image_filename) }}"
          alt="Profile Picture"
          loading="lazy"
        />
      {% endif %}
    </div>

    <!-- Name Tile -->
    <div id="name" class="box" style="grid-area: name;">
      <p class="full-name">{{ name.full_name }}</p>
      <h2 class="title">{{ name.title }}</h2>
      <p class="intro" id="typewriter-intro">{{ name.intro }}</p>
    </div>

    <!-- Project Tiles -->
    {% for project in projects %}
      <button
        id="project{{ project.id }}"
        class="box project-tile {{ project.project_type|lower }}"
        style="grid-area: {{ project.grid_position }};"
        data-project-id="{{ project.id }}"
      >
        <div class="project-content">
          <h3 class="project-title">{{ project.title }}</h3>
          <img
            class="project-image"
            src="{{ url_for('static', filename='images/' + project.image_filename) }}"
            alt="{{ project.title }}"
            loading="lazy"
          />
        </div>
      </button>
    {% endfor %}
  </div>

  <!-- Project Modals -->
  {% for project in projects %}
    <div id="modal{{ project.id }}" class="modal">
      <div class="modal-content">
        <!-- Close Button -->
        <span class="close" data-modal-id="{{ project.id }}">&times;</span>
        <!-- Modal Details -->
        <h2>{{ project.title }}</h2>
        {% if project.position %}
          <p><strong>Position:</strong> {{ project.position }}</p>
        {% endif %}
        {% if project.term %}
          <p><strong>Term:</strong> {{ project.term }}</p>
        {% endif %}
        {% if project.description %}
          <p>{{ project.description }}</p>
        {% endif %}
        {% if project.link %}
          <p>
            <a href="{{ project.link }}" target="_blank">Learn More</a>
          </p>
        {% endif %}
        <!-- Additional Images (if any) -->
        <div class="image-gallery">
          {% for image in project.images %}
            <img
              src="{{ url_for('static', filename='images/' + image.image_filename) }}"
              alt="{{ project.title }} Image {{ loop.index }}"
              loading="lazy"
            />
          {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}

  <!-- Typewriter JS -->
  <script src="{{ url_for('static', filename='js/typewriter.js') }}"></script>

  <!-- Easter Egg & Bomb Animation Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const profileImg = document.querySelector('#profileImg');
      const body = document.body;
      let clickCount = 0;
      let easterEggTriggered = false;
      let timerExpired = false;

      // Create bomb element for the animation
      const bomb = document.createElement('div');
      bomb.id = 'bomb';
      bomb.style.position = 'absolute';
      bomb.style.width = '50px';
      bomb.style.height = '50px';
      bomb.style.backgroundImage = "url('{{ url_for('static', filename='images/bomb.png') }}')";
      bomb.style.backgroundSize = 'contain';
      bomb.style.backgroundRepeat = 'no-repeat';
      bomb.style.pointerEvents = 'none';
      bomb.style.display = 'none';
      bomb.style.zIndex = '1000';
      body.appendChild(bomb);

      // 1-minute timer
      setTimeout(() => {
        timerExpired = true;
        if (easterEggTriggered) {
          // Reset to original image
          profileImg.src = "{{ url_for('static', filename='images/' + profile.image_filename) }}";
          easterEggTriggered = false;
        }
      }, 60000);

      // Move bomb with mouse
      body.addEventListener('mousemove', (e) => {
        bomb.style.left = `${e.pageX}px`;
        bomb.style.top = `${e.pageY}px`;
      });

      // Click logic on profile image
      profileImg.addEventListener('click', () => {
        if (easterEggTriggered || timerExpired) return;

        clickCount++;
        bomb.textContent = clickCount;
        bomb.style.display = 'block';

        // Hide bomb after 300ms
        setTimeout(() => {
          bomb.style.display = 'none';
        }, 300);

        if (clickCount >= 20) {
          // Flip animation
          profileImg.classList.add('flip-animation');
          setTimeout(() => {
            profileImg.src = "{{ url_for('static', filename='images/surprise_profile.jpg') }}";
            profileImg.classList.remove('flip-animation');
            easterEggTriggered = true;
          }, 500);
        }
      });
    });
  </script>

  <!-- Slideshow Script (if any background slides) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const slideshows = document.querySelectorAll('.slideshow-container');

      slideshows.forEach((slideshow) => {
        const slides = slideshow.querySelectorAll('.slide');
        let currentSlide = 0;

        if (slides.length > 0) {
          slides[0].style.left = '0';
        }

        setInterval(() => {
          if (slides.length > 1) {
            slides[currentSlide].style.left = '-100%';
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].style.left = '0';
          }
        }, 4000);
      });
    });
  </script>
</body>
</html>
