<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ryo Fujimura</title>
  <!-- Google Fonts for MuseoModerno -->
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno&display=swap" rel="stylesheet" />
  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <!-- Optional: Font Awesome (if using icons) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-pVvFdqYPPgk3mpmKjcNJIg8eI4kKKykX8q0Y/PAF1KyfW3zNFPKqfB0IzxaPlxnjTqIKz2BtfN6+7VZIl9+qPQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
</head>
<body>
  <div class="container">
    <!-- Logo Tile -->
    <div id="logo" class="box" style="grid-area: logo;">
      {% if logo.image_filename %}
        <img
          src="{{ url_for('static', filename='images/' + logo.image_filename) }}"
          alt="Ryo Fujimura's Logo"
          loading="lazy"
        />
      {% endif %}
    </div>

    <!-- Profile Picture Tile -->
    <div id="profilePicture" class="box" style="grid-area: profilePicture;">
      {% if profile.image_filename %}
        <img
          src="{{ url_for('static', filename='images/' + profile.image_filename) }}"
          alt="Profile Picture"
          loading="lazy"
        />
      {% endif %}
    </div>

    <!-- Loop through Projects -->
    {% for project in projects %}
      <!-- Make the entire tile a button -->
      <button
        id="project{{ project.id }}"
        class="box project-tile"
        style="grid-area: {{ project.grid_position }};"
        data-project-id="{{ project.id }}"
      >
        <!-- Sticker at Top-Right -->
        <div class="sticker {{ project.project_type|lower }}">
          {{ project.project_type }}
        </div>

        <!-- Centered Content: Title (large) + Smaller Image -->
        <div class="project-content">
          <!-- Large Title -->
          <h3 class="project-title">{{ project.title }}</h3>
          <!-- Smaller Image -->
          {% if project.image_filename %}
            <img
              class="project-image"
              src="{{ url_for('static', filename='images/' + project.image_filename) }}"
              alt="{{ project.title }}"
              loading="lazy"
            />
          {% endif %}
        </div>
      </button>
    {% endfor %}

    <!-- Name Tile -->
    <div id="name" class="box" style="grid-area: name;">
      <p class="full-name">{{ name.full_name }}</p>
      <h2 class="title">{{ name.title }}</h2>
      <p class="intro" id="typewriter-intro">{{ name.intro }}</p>
    </div>
  </div>

  <!-- Project Modals -->
  {% for project in projects %}
    <div id="modal{{ project.id }}" class="modal">
      <div class="modal-content">
        <!-- Close Button -->
        <span class="close" data-modal-id="{{ project.id }}">&times;</span>

        <!-- Modal Details -->
        <h2>{{ project.title }}</h2>
        {% if project.position %}
          <p><strong>Position:</strong> {{ project.position }}</p>
        {% endif %}
        {% if project.term %}
          <p><strong>Term:</strong> {{ project.term }}</p>
        {% endif %}
        {% if project.description %}
          <p>{{ project.description }}</p>
        {% endif %}
        {% if project.link %}
          <p>
            <a href="{{ project.link }}" target="_blank">Learn More</a>
          </p>
        {% endif %}

        <!-- Additional Images (if any) -->
        <div class="image-gallery">
          {% for image in project.images %}
            <img
              src="{{ url_for('static', filename='images/' + image.image_filename) }}"
              alt="{{ project.title }} Image {{ loop.index }}"
              loading="lazy"
            />
          {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}

  <!-- Typewriter JS -->
  <script src="{{ url_for('static', filename='js/typewriter.js') }}"></script>

  <!-- Modal Handling JS -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const projectTiles = document.querySelectorAll('.project-tile');
      const modals = document.querySelectorAll('.modal');
      const closes = document.querySelectorAll('.close');

      // Open modal on tile click
      projectTiles.forEach((tile) => {
        tile.addEventListener('click', () => {
          const projectId = tile.getAttribute('data-project-id');
          const modal = document.getElementById(`modal${projectId}`);
          if (modal) {
            modal.style.display = 'block';
            history.pushState(null, '', `#project${projectId}`);
          }
        });
      });

      // Close modal on clicking close button
      closes.forEach((close) => {
        close.addEventListener('click', () => {
          const projectId = close.getAttribute('data-modal-id');
          const modal = document.getElementById(`modal${projectId}`);
          if (modal) {
            modal.style.display = 'none';
            history.pushState(null, '', window.location.pathname);
          }
        });
      });

      // Close modal when clicking outside modal content
      window.addEventListener('click', (event) => {
        modals.forEach((modal) => {
          if (event.target === modal) {
            modal.style.display = 'none';
            history.pushState(null, '', window.location.pathname);
          }
        });
      });

      // Open modal if URL has a #project hash
      const hash = window.location.hash;
      if (hash.startsWith('#project')) {
        const projectId = hash.replace('#project', '');
        const modal = document.getElementById(`modal${projectId}`);
        if (modal) {
          modal.style.display = 'block';
        }
      }

      // Handle back/forward browser navigation
      window.addEventListener('popstate', () => {
        const newHash = window.location.hash;
        // Close all modals first
        modals.forEach((modal) => {
          modal.style.display = 'none';
        });
        if (newHash.startsWith('#project')) {
          const projectId = newHash.replace('#project', '');
          const modal = document.getElementById(`modal${projectId}`);
          if (modal) {
            modal.style.display = 'block';
          }
        }
      });
    });
  </script>
</body>
</html>
